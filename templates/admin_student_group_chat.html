{% extends "base.html" %}

{% block title %}Student Group Chat - CourseHub Admin{% endblock %}

{% block content %}
<div class="chat-container">
  <div class="chat-card">
    <div class="chat-header">
      <strong>Student Group Chat</strong>
      <span style="color: var(--text-secondary); font-size: 13px;">(View only student messages)</span>
    </div>
    <div class="chat-body" id="chatBody"></div>
  </div>
</div>

<script>
const bodyEl = document.getElementById('chatBody');
function scrollBottom(){ bodyEl.scrollTop = bodyEl.scrollHeight; }

function escapeHtml(str){
  const p = document.createElement('p');
  p.appendChild(document.createTextNode(str));
  return p.innerHTML;
}

function renderMessage(msg){
  const wrap = document.createElement('div');
  wrap.className = 'msg them';
  const label = msg.sender || 'Student';
  const time = msg.time || '';
  wrap.innerHTML = `<div class=\"bubble\"><strong style=\"display:block; font-size:12px; color: var(--text-secondary);\">${label}</strong>${escapeHtml(msg.message)}<span class=\"time\">${time}</span></div>`;
  bodyEl.appendChild(wrap);
}

function loadHistory(){
  fetch('/api/chat/history-students')
    .then(r=>r.json())
    .then(d=>{
      if(d.success){
        bodyEl.innerHTML = '';
        d.messages.forEach(renderMessage);
        scrollBottom();
      }
    });
}

loadHistory();
setInterval(loadHistory, 5000);
</script>
{% endblock %}


